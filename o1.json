{
  "checkout": {
    "summary": "Checkout the source code for the Python Jenkins pipeline project.",
    "jenkins_steps": [
      "checkout scm"
    ],
    "notes": []
  },
  "setup": {
    "summary": "Prepare the Python environment and install dependencies inside the docker agent container.",
    "jenkins_steps": [
      "sh 'pip install --upgrade pip'",
      "sh 'pip install -r requirements.txt'"
    ],
    "parallelizable_with": [
      "build",
      "test"
    ],
    "notes": [
      "This combines the original 'Environment preparation' stage with dependency installation.",
      "Cache pip downloads will speed up repeated builds."
    ]
  },
  "build": {
    "summary": "Compile Python sources and build the Docker image that will be used for integration and performance testing.",
    "jenkins_steps": [
      "sh 'python -m compileall .'",
      "sh 'docker build -t restalion/python-jenkins-pipeline:${env.BUILD_NUMBER} .'"
    ],
    "notes": [
      "The compile step comes from the original 'Compile' stage.",
      "The Docker build step comes from 'Build Docker image'; we intentionally do not push the image here."
    ]
  },
  "test": {
    "summary": "Run all levels of testing: unit tests, mutation tests, integration tests, and performance tests against the running Docker container.",
    "jenkins_steps": [
      "sh 'docker run --name python-jenkins-pipeline --detach --rm --network ci -p 5001:5000 restalion/python-jenkins-pipeline:${env.BUILD_NUMBER}'",
      "sh 'nosetests -v test'",
      "sh 'cosmic-ray init config.yml jenkins_session && cosmic-ray --verbose exec jenkins_session && cosmic-ray dump jenkins_session | cr-report'",
      "sh 'nosetests -v int_test'",
      "sh 'locust -f ./perf_test/locustfile.py --no-web -c 1000 -r 100 --run-time 1m -H http://172.18.0.3:5001'",
      "sh 'docker stop python-jenkins-pipeline || true'"
    ],
    "notes": [
      "This aggregates the 'Unit tests', 'Mutation tests', 'Run Docker image', 'Integration tests', and 'Performance tests' stages into a single logical Test stage.",
      "If runtime is high, some of these could be parallelized in a future refinement."
    ]
  },
  "quality": {
    "summary": "Run dependency vulnerability checks and code inspection (linting) as quality gates.",
    "jenkins_steps": [
      "sh 'safety check'",
      "sh 'pylama'"
    ],
    "notes": [
      "This combines 'Dependency vulnerability tests' and 'Code inspection & quality gate'.",
      "The original 'Push Docker image' stage is intentionally omitted (no deploy/publish in this plan)."
    ]
  }
}